<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<title></title>
<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<ul class="lists clearfix"></ul>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript">
// 今回やるのは神経衰弱です。
// 今までの課題と違い、ロジックっぽいロジックを書きます。JS書いてるんだなーって気持ちになります。
// まずゲームの流れを説明します。
//  
// ①: 16枚のリストの中から "?" と書かれたものをひとつクリックする
// ②: その要素に書かれている "?" が "6" などの数字に変わる
// ③: もうひとつ"?"と書かれたものをクリックする
// ④: その要素に書かれている "?" が "6" などの数字に変わる
// ⑤: ②と④で表示された数字が一致している場合は、開いた数字はそのままで①に戻る。一致していない場合は1秒後に数字が "?" に戻り①にもどる。
// ⑥: 全ての要素が開かれたときにアラートで "Game Over"
// 
// 以上が全体の流れです。
// ここからはプログラムの説明です。
// まず最初にやらなければいけないことは、16枚のリストを表示するです。
// ただ単純な配列であればfor文を用いれば、簡単につくることが出来ますが、今回作るのは "1~8までの数字を2つずつ" かつ "ランダム" にしないといけません。
// おそらくこの部分が一番の鬼門ですが、どうにかクリアしましょう。
// 配列さえ出来上がってしまえば、for文を使って <li> を変数に文字列でくっつけてあげましょう。 <li> 自体の中身は "?" にし、data属性に先ほど作った配列の値を入れてあげると今後楽になるかと思います。for文の中ではなく、外でappendしましょうね（ニッコリ
// 
// 次はクリックイベントについて説明します。
// 流れの部分をよく読んでif文とか使って実装しましょう（適当
// ちなみに setTimeout などを使うことで1秒後に〜するなどは実装出来ます。
// クリックした要素は必ず変数に格納しましょう。こうすることで比較が非常に簡単です。
// 以上になります。10個の中で一番難しい"らしい"のですが、頑張ってクリアしましょう！
/**
  * （説明）
  * @type {array} cardNum ← カードの配列
  * @type {string} totalCard ← カードの枚数
  * @param {object} $card ← カードの引数
  * @type {string} $firstCard ← カードをめくる1枚目
  * @type {string} $secondCard ← カードをめくる2枚目
  * @type {firstNum} $firstNum ← カードに書かれている数字
  * @type {secondNum} $secondNum ← カードに書かれてる数字
  * @type {string} $openedCard ← めくられたカード
  *
  *
**/
$(function(){
  let cardNum = [];
  let totalCard = 16;
  let f = false;

  function open($card){
    $card.css('pointer-events', 'none');
    $card.text($card.data('num'));
  }

  function close($card){
    $card.css('pointer-events', '');
    $card.text('?');
  }

  function compare($card){
    // 1枚目に開いたカードが存在するか確認
    // 存在すれば、即ち、現在は2枚目のカードを開いたところ 
    if($('.firstOpen').length == 0){
      // 開いたカードが一枚目のカードであれば、
      // この要素が1枚目であることがわかるようにするため、
      // firstOpenのクラスを付与しておく
      f = false;
      $card.addClass('firstOpen');
    }else{
      // 1枚目のカードのjQueryオブジェクト
      let $firstCard = $('.firstOpen');
      // 2枚目のカードのjQueryオブジェクト
      let $secondCard = $card;

      // 1枚目のカードの数字
      let firstNum = $firstCard.data('num');
      // 2枚目のカードの数字
      let secondNum = $secondCard.data('num');

      // 1枚目識別用のクラスを削除
      $firstCard.removeClass('firstOpen');

      // 一致している場合、両方からunopenedを削除する
      // その後、unopenedが付与された要素の数を確認し、
      // 0個であれば、アラートを表示する
      if(firstNum === secondNum){
        f = false;
        $firstCard.removeClass('unopened');
        $secondCard.removeClass('unopened');
 
        if($('.unopened').length === 0){
          alert("Game Over");
        }
      // 一致していない場合、二枚とも閉じる
      }else{
        setTimeout(function(){
          f = false;
          close($firstCard);
          close($secondCard);
        }, 1000);
      }
    }
  }

  // カードの中身を作成
  for (var i = 1; i <= totalCard/2; i++){
    cardNum.push(i,i);
  }

  // ランダムに並べ替えて
  // li要素を作成して
  // listに追加

  cardNum
    .sort(function(){
      return Math.random() - Math.random();
    })
    .map(function(num){
      return "<li class='unopened' data-num='" + num + "'>?</li>";
    })
    .forEach(function(element){
      $(".lists").append(element);
    });

  $('.lists li').on('click', function(){
    if (f) return;
    // クリックされたカード(li要素)のjQueryオブジェクト
    f = true;
    let $openedCard = $(this);

    // カードをオープン
    open($openedCard);

    // カードを比較
    // 1秒ほど待機させてから比較させる
    // ※待機しないと二枚目のカードの番号が表示されるとほぼ同時ぐらいに比較が終わり
    // 二枚目のカードの数字がわかりにくいため
      compare($openedCard);
  });
});


// $(function(){
//   var $ul = $(".lists"),
//     totalCard = 15, //カード枚数
//     numbers = []; //カード配列

//   //     returnSec = 1000, //めくったカードが戻る秒数
//   //     index; //クリックしたカードの並び順
//   //     first = true, //クリックしたカードが1枚目かどうかの判定
//   //     card1,  //1枚目に引いたカードの番号
//   //     card2,  //2枚目に引いたカードの番号
//   //     pair = 0; //正解したカードのペア数

//   //カード番号を配列に格納
//   for (var i = 0; i <= totalCard/2; i++){
//     numbers.push(i,i);
//   }

//   //配列の中身をランダムに並び替える
//   numbers.sort(function(){
//     return Math.random() - Math.random();
//   });


//   //カードを追加
//   var listItems = numbers.map(function(num){
//     return "<li data-num='" + num + "'>?</li>";
//   });


//   $ul.append(listItems);

//   // カードめくり
//   $('li').click(function(){
//     $(this).text($(this).data('num'));
//   });

// });

// var total = 16;    //カードの枚数
// var isFirst = true;    //1枚目か判定
// var card1 = "";    //array_cardsのindex（1枚目）
// var card2 = "";    //array_cardsのindex（2枚目）
// var array_cards = [];    //カードに表示する数値を格納する配列
// //カードに表示する数値を生成
// //array_cards = [1,1,2,2,3,3,4,4,5,5]となる）
// for(i=1; i <= total/2; i++) {
//   array_cards.push(i,i);
// }
// //array_cards配列の数値をランダムに並び替える
// array_cards.sort(function() {
//   return Math.random() - Math.random();
// });
// //ulに空のli要素を追加
// for(i=0; i < total; i++) {
//   $(".lists").append("<li></li>");  
// }
// //li要素をクリックした際の処理
// $(".lists li").on("click",function(){
//   //1枚目の場合は、全li要素のテキストを空にする
//   if(isFirst){
//     $(".lists li").text("");
//   }
//   //li要素のindexを取得
//   var index = $(this).index();
  
//   //li要素のindexと同じindexであるarray_cards配列の値を表示する
//   $(this).text(array_cards[index]);
    
//   if(isFirst){
//     //１枚目
//     card1 = index;
//     isFirst = false;
//   }else{
//     //2枚目
//     card2 = index;
//     //1枚目と2枚目の値が同じ場合はli要素の背景色を赤にする
//     if(array_cards[card1] === array_cards[card2]){
//       $(".lists li").eq(card1).css("background-color","red");
//       $(".lists li").eq(card2).css("background-color","red");
//     }
//     isFirst = true;    
//   }  
// });
</script>
</body>
</html>
